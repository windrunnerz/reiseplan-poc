{% extends "base.html" %}
{% block title %}Reiseplan{% endblock %}

{% block sidebar %}
  <div class="page-sidebar-wrapper">
    <aside class="page-sidebar">
      <h3>Reise√ºbersicht</h3>
      <ol id="reise-nav">
        {% for abschnitt in plan %}
          {% set anchor_id = abschnitt.title|default('abschnitt-' ~ loop.index)|lower
              |replace(' ', '-')|replace('√§','ae')|replace('√∂','oe')
              |replace('√º','ue')|replace('√ü','ss') %}
          <li><a href="#{{ anchor_id }}">{{ abschnitt.title }}</a></li>
        {% endfor %}
      </ol>
    </aside>
  </div>
{% endblock %}

{% block content %}
  <section class="reise-section">
    <h1>üó∫Ô∏è Reiseplan</h1>

    <div class="card">
      <p><strong>Reiseverlauf:</strong> {{ " ‚Üí ".join(route_chain) | title }}</p>
    </div>

    {% if error %}
      <p class="error">‚ùå {{ error|safe }}</p>
    {% elif not plan %}
      <p>‚ö†Ô∏è Keine passenden Textbausteine f√ºr die Route
         <strong>{{ ' ‚Üí '.join(route_chain) }}</strong> gefunden.</p>
    {% else %}
      {% for abschnitt in plan %}
        {% set anchor_id = abschnitt.title|default('abschnitt-' ~ loop.index)|lower
            |replace(' ', '-')|replace('√§','ae')|replace('√∂','oe')
            |replace('√º','ue')|replace('√ü','ss') %}
        <div class="card" id="{{ anchor_id }}">
          <h3>{{ abschnitt.title }}</h3>

          {% if abschnitt.type == "city" %}
            <p><em>Ort:</em> {{ abschnitt.ort }}</p>
          {% elif abschnitt.type.startswith("route") %}
            <p><em>Von:</em> {{ abschnitt.start_ort }} ‚Üí <em>Nach:</em> {{ abschnitt.ziel_ort }}</p>
          {% endif %}

          <p>{{ abschnitt.text }}</p>

          {% if abschnitt.varianten %}
            <details>
              <summary><strong>Alternative Routen</strong></summary>
              {% for v in abschnitt.varianten %}
                <p><u>{{ v.name }}</u>: {{ v.beschreibung }}</p>
                {% if v.zwischenstopps %}
                  <ul>
                    {% for z in v.zwischenstopps %}
                      <li><strong>{{ z.ort }}</strong>: {{ z.highlight }} ‚Äî {{ z.details }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}
              {% endfor %}
            </details>
          {% endif %}

          {% if abschnitt.image %}
            <img src="{{ url_for('static', filename='images/' + abschnitt.image) }}" 
                 alt="{{ abschnitt.title }}">
          {% endif %}
        </div>
      {% endfor %}
    {% endif %}

    <div class="text-center mt-3">
      <button type="button" class="btn">
        PDF Export (Demn√§chst)
      </button>
      <button type="button" class="btn cancel" onclick="window.location.href='/'">
        ‚¨ÖÔ∏è Neue Eingabe
      </button>
    </div>
  </section>
{% endblock %}
